if (self.CavalryLogger) { CavalryLogger.start_js(["49B6q"]); }

__d("XMessagingDeferredAttachmentController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messages\/load_deferred_attachment\/",{dest_id:{type:"String",required:true},mid:{type:"String",required:true}});}),null);
__d('MMessagesNewMessageBlockRenderer',['ActorURI','DOM','HTML','MDynaTemplate','MItemConstants','MMessagesThreadImageRenderer','MMessageUtils','MRequest','XMessagingDeferredAttachmentController','emojiAndEmote'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r='\xb7',s='text',t='deferred';function u(z,aa){var ba={};ba.author_name=z.getAuthorName();ba.author_href=aa.author_href;ba.message=z.getMessage();var ca=null;if(aa.should_parse_emoticons){ca=i.create('span',{},q(ba.message,{isSupportedEmoji:aa.is_supported_emoji,getMessengerEmote:aa.get_messenger_emote}));ba.message='';}var da=void 0,ea=x(z);if(ea===t){var fa=y(z);ba.deferred_attachment_id=fa;da=k.renderToHtml('@MDeferredAttachmentMessageTemplate',ba);var ga=p.getURIBuilder().setString('dest_id',fa).setString('mid',z.getUUID()).getURI();ga=h.create(ga,aa.page_id).toString();new o(ga).setMethod('GET').send();}else da=k.renderToHtml('@MChatMessageTemplate',ba);var ha=new j(da).getFragment().firstChild,ia=i.find(ha,'*','profile_image');i.replace(ia,m.participantImage(z.getAuthorFBID(),l.SHORT_HEIGHT));if(aa.should_parse_emoticons){var ja=i.find(ha,'div','message-text');ja.appendChild(ca);}if(z.getAuthorFBID()!==aa.user){var ka=v(z.getMessageSource(),aa.download_link),la=i.find(ha,'div','action-list');i.appendContent(la,ka);}return ha;}function v(z,aa){var ba=n.getMessageSourceText(z);if(!ba)return '';var ca='';if(w(z,aa)){ca=k.renderToHtml('@MMessageSourceTextWithLinkTemplate',{text:ba,download_href:aa});}else ca=k.renderToHtml('@MMessageSourceTextTemplate',{text:ba});var da=i.create('span',new j(ca));i.prependContent(da,new j(' '+r+' '));return da;}function w(z,aa){if(!(z==='source:chat:orca'||z==='source:titan:orca'))return false;return !!aa;}function x(z){if(z.getAttachmentCount())return t;return s;}function y(z){return 'deferred_attachment:'+z.getUUID();}f.exports=u;}),null);
__d('MMessagesNewTextMessageRenderer',['JSXDOM','emojiAndEmote'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l){return (h.div({sigil:'message-text'},h.span(null,l.should_parse_emoticons?i(k.getMessage(),{isSupportedEmoji:l.is_supported_emoji,getMessengerEmote:l.get_messenger_emote}):k.getMessage())));}f.exports=j;}),null);
__d('MMessagesReadReceiptsDOM',['DOM','HTML','MDateString','MDynaTemplate','MMessageUtils','Stratcom','$','fbt'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p='\xb7';function q(){h.scry(n('messageGroup'),'div','read-receipt').forEach(function(t){h.remove(t);});h.scry(n('messageGroup'),'span','read-receipt').forEach(function(t){var u=t.parentNode.childNodes;for(var v=0;v<u.length;v+=1)if(u[v]===t){if(v>0&&u[v-1]&&u[v-1].data&&u[v-1].data.trim()===p){h.remove(u[v-1]);}else if(v>1&&'getAttribute' in u[v-2]&&u[v-2].getAttribute('role')==='separator'){h.remove(u[v-1]);h.remove(u[v-2]);h.remove(u[v-3]);}break;}h.remove(t);});}function r(t,u,v,w){var x=h.scry(t.parentNode,'div','message-text').pop(),y=false;if(x===t)y=true;var z=y?h.create('span'):h.create('div');m.addSigil(z,'read-receipt');var aa,ba=Object.keys(v);if(Object.keys(w.users_short_names).length<=2&&ba.length==1){aa=s(v[ba[0]]);}else aa=l.getSeenByParticipantsText(ba,w.users_short_names,u.author,w.user);var ca=k.renderToHtml('@MReadReceiptTextTemplate',{text:aa});h.appendContent(z,new i(ca).getFragment().firstChild);if(y){var da=t.parentNode;while(!m.hasSigil(da,'message-xhp'))da=da.parentNode;var ea=h.find(da,'div','action-list');h.appendContent(ea,new i(' '+p+' '));h.appendContent(ea,z);}else h.appendContent(t,z);}function s(t){t=t*.001;var u=j.displayTime(t,{compact:true,relative:false});return o._("Visualizado \u2014 {timestamp}",[o.param('timestamp',u)]);}f.exports={clearAll:q,addNew:r};}),null);
__d('MP2PNUXRendererUtils',['ImmutableObject','MercuryAttachmentType','StoryAttachmentStyle'],(function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k={getTransferFromAttachments:function l(m){if(!m||!m.length)return null;var n=m[0],o=void 0;if(this.isShareAttachment(n))o=n.share.target;if(o)o=new h(o);return o;},isShareAttachment:function l(m){return !!(typeof m!=='string'&&m.attach_type==i.SHARE&&m.share&&m.share.style_list&&m.share.style_list.indexOf(j.ORION)>=0);}};f.exports=k;}),null);
__d('MMessages',['setTimeoutAcrossTransitions','CSS','MLegacyDataStore','DOM','MMessageUtils','MMessagesNewMessageBlockRenderer','MMessagesNewTextMessageRenderer','MMessagesReadReceipts','MMessagesReadReceiptsDOM','MessagingEvent','MessengerSupportedEmoji','MDateString','MP2PNUXRendererUtils','MViewport','$','MOrionAttachmentBody'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=c('MOrionAttachmentBody').module;function x(y){this._user=y.userID;this._pageID=y.pageID;this._messageSubject=y.messageSubject;this._messageThreadID=y.messageThreadID;this._messageOtherUserFBID=y.messageOtherUserFBID;this._messageThreadFBID=y.messageThreadFBID;if(y.isCanonicalThread)this._typingIndicator=y.typingIndicatorElement;this._usersProfileUri=y.usersProfileUri;this._usersShortNames=y.usersShortNames;this._parseEmoticons=y.parseEmoticons;this._downloadLink=y.downloadLink;this._orcaPromotionBoxVisible=false;}x.prototype.handleUserTyping=function(event){var y=event.getData();if(this._typingIndicator&&y.from==this._messageSubject){k.show(this._typingIndicator);clearTimeout(this._deferredHide);this._deferredHide=h(function(){if(this._typingIndicator)k.hide(this._typingIndicator);}.bind(this),4000);}};x.prototype.handleMessageReceived=function(event){var y=event.getData();if(y.event===q.READ_RECEIPT&&y.is_sync){this._readReceipts(y);return;}var z=y.parsedPayload;if(!z||!this._payloadIsForThisThread(z)||this._alreadyHasMessage(z.getUUID()))return;if(this._typingIndicator){clearTimeout(this._deferredHide);k.hide(this._typingIndicator);}p.clearAll();var aa=void 0;aa=this._addNewMessage(z);if(aa){i.conditionClass(aa,'chatHighlight',true);u.scrollToNode(v('composerInput'));}};x.prototype._payloadIsForThisThread=function(y){if(this._messageOtherUserFBID!==null){return this._messageOtherUserFBID===y.getOtherUserFBID();}else if(this._messageThreadFBID!==null)return this._messageThreadFBID===y.getThreadFBID();return false;};x.prototype._addNewMessage=function(y){var z=null,aa=k.scry(v('messageGroup'),'div','message-xhp').pop();if(this._shouldCreateNewMessageBlock(aa,y)){var ba={author_href:this._usersProfileUri[y.getAuthorFBID()],page_id:this._pageID,should_parse_emoticons:this._parseEmoticons,user:this._user,download_link:this._downloadLink,is_supported_emoji:r.isSupportedEmoji,get_messenger_emote:r.getMessengerEmote},ca=m(y,ba),da={name:y.getAuthorName(),attachment_count:y.getAttachmentCount(),message_source:y.getMessageSource()};j.set(ca,da);this._setTimestamp(ca);var ea=k.scry(ca,'img','attachment-image');ea.forEach(function(ha){ha.addEventListener('load',function(){u.scrollToNode(v('composerInput'));});});var fa=k.find(ca,'div','message-text');j.set(fa,this._getMessageTextData(y));k.appendContent(v('messageGroup'),ca);var ga=this._createSystemNewMessageBlock(y);if(ga)k.appendContent(v('messageGroup'),ga);if(!this._orcaPromotionBoxVisible&&this._orcaPromotionBox&&this._shouldDisplayOrcaPromotionBox(y)){k.show(this._orcaPromotionBox);this._orcaPromotionBoxVisible=true;}z=ca;}else z=this._addMessageToExisting(aa,y);return z;};x.prototype._shouldDisplayOrcaPromotionBox=function(y){if((y.getMessageSource()==='source:chat:orca'||y.getMessageSource()==='source:titan:orca')&&y.getAuthorFBID()!==this._user)return true;return false;};x.prototype._shouldCreateNewMessageBlock=function(y,z){if(!y)return true;var aa=j.get(y);if(l.getMessageSourceText(aa.message_source)!=l.getMessageSourceText(z.getMessageSource()))return true;if(aa.name==z.getAuthorName()&&!aa.attachment_count&&!z.getAttachmentCount())return false;return true;};x.prototype._readReceipts=function(y){var z=Object.keys(y.message.roger)[0];if(z!==(this._messageOtherUserFBID||this._messageThreadFBID))return;p.clearAll();var aa=k.scry(v('messageGroup'),'div','message-text').reverse(),ba=aa.map(function(ja){return j.get(ja);}),ca=this._pageID||this._user,da={};da[ca]=true;for(var ea=0,fa;fa=ba[ea];ea++){da[fa.author]=true;var ga=o.getSeenBy(this._messageOtherUserFBID?this._messageOtherUserFBID:this._messageThreadFBID,parseInt(fa.timestamp,10),Object.keys(da));for(var ha in ga)da[ha]=true;if(Object.keys(ga).length){var ia={users_short_names:this._usersShortNames,user:this._user};p.addNew(aa[ea],ba[ea],ga,ia);}}};x.prototype._alreadyHasMessage=function(y){if(y){var z=k.scry(v('messageGroup'),'div','message-text');for(var aa=0,ba;ba=z[aa];aa+=1){var ca=j.get(ba);if(ca.uuid==y)return true;}}return false;};x.prototype._getMessageTextData=function(y){return {author:y.getAuthorFBID(),timestamp:y.getTimestamp(),uuid:y.getUUID()};};x.prototype._addMessageToExisting=function(y,z){var aa=k.find(y,'span','message-body').parentNode,ba={should_parse_emoticons:this._parseEmoticons,is_supported_emoji:r.isSupportedEmoji,get_messenger_emote:r.getMessengerEmote},ca=n(z,ba);j.set(ca,this._getMessageTextData(z));k.appendContent(aa,ca);return ca;};x.prototype._createSystemNewMessageBlock=function(y){var z=null;if(w){var aa=t.getTransferFromAttachments(y.getAttachments());if(aa){var ba={transactionId:aa.transfer_id,senderId:aa.sender.id};z=w.createNUX(ba,function(){return u.scrollToNode(v('composerInput'));});}}return z;};x.prototype._setTimestamp=function(y){var z=k.find(y,'abbr','timestamp');z.setAttribute('data-meta',null);var aa=Math.floor(Date.now()/1000);j.set(z,{time:aa});k.setContent(z,s.displayTime(aa));};Object.assign(x.prototype,{_user:null,_deferredHide:null,_messageSubject:null,_messageThreadID:null,_messageOtherUserFBID:null,_messageThreadFBID:null,_typingIndicator:null,_usersProfileUri:null,_usersShortNames:null});f.exports=x;}),null);